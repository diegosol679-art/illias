<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ILLIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;family=Playfair+Display:wght@700&amp;display=swap');
        
        :root {
            --glass: rgba(0, 0, 0, 0.65);
        }
        
        .glass {
            background: var(--glass);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
        }
        
        .nav-glass {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(40px);
        }
        
        .card {
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.4);
        }
        
        .landing {
            transition: all 1.2s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .star {
            transition: all 0.2s ease;
        }
        
        .modal {
            animation: modalPop 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.8) translateY(40px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .review-gif {
            max-height: 240px;
            object-fit: cover;
            border-radius: 12px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .bottom-nav {
            box-shadow: 0 -10px 30px -15px rgba(255,255,255,0.1);
        }
    </style>
</head>
<body class="bg-black text-white overflow-hidden">
    <!-- LANDING -->
    <div id="landing" class="landing fixed inset-0 z-50 flex items-center justify-center bg-black">
        <div class="text-center">
            <div class="mb-12">
                <h1 id="logo" 
                    class="text-[120px] leading-none font-black tracking-[-0.08em] text-white"
                    style="font-family: 'Playfair Display', serif; text-shadow: 0 0 80px rgba(255,255,255,0.3);">
                    ILLIA
                </h1>
                <p class="text-white/40 text-sm tracking-[4px] font-mono mt-2">PERSONAL CINEMA</p>
            </div>
            
            <button onclick="enterApp()" 
                    id="enter-btn"
                    class="glass group relative px-16 py-6 rounded-3xl border border-white/30 text-2xl font-semibold tracking-widest hover:border-white/60 transition-all flex items-center gap-4 mx-auto overflow-hidden">
                <span class="relative z-10">ENTER THE VOID</span>
                <i class="fa-solid fa-arrow-right text-3xl group-active:rotate-45 transition-transform"></i>
                <div class="absolute inset-0 bg-white/10 scale-x-0 group-hover:scale-x-100 origin-left transition-transform"></div>
            </button>
            
            <div class="mt-24 text-white/20 text-xs font-mono tracking-widest">v4.20 • BUILT FOR DIEGO</div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app" class="hidden min-h-screen flex flex-col">
        <!-- HEADER -->
        <div class="glass border-b border-white/10 px-6 py-4 flex items-center justify-between fixed top-0 left-0 right-0 z-40">
            <div class="flex items-center gap-3">
                <div onclick="switchTab(0)" class="cursor-pointer">
                    <span class="text-2xl font-black tracking-tighter">ILLIA</span>
                </div>
            </div>
            <div class="flex items-center gap-6 text-white/60">
                <i onclick="logout()" class="fa-solid fa-right-from-bracket cursor-pointer hover:text-white transition-colors"></i>
            </div>
        </div>

        <!-- CONTENT -->
        <div class="flex-1 pt-20 pb-24 overflow-y-auto" id="content-area">
            
            <!-- HOME TAB -->
            <div id="tab-0" class="tab-content active px-6 pt-6">
                <div class="mb-8">
                    <h2 class="text-3xl font-semibold mb-1">Recent Reviews</h2>
                    <p class="text-white/40 text-sm">From the void</p>
                </div>
                
                <div id="recent-reviews" class="space-y-8"></div>
                
                <div class="my-12">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-3xl font-semibold">Recent Movies</h2>
                        <button onclick="switchTab(1)" 
                                class="text-xs px-5 py-2 border border-white/30 rounded-2xl hover:bg-white/10 transition-colors flex items-center gap-2">
                            <i class="fa-solid fa-list"></i>
                            <span>WATCHLIST</span>
                        </button>
                    </div>
                    <div id="recent-movies" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
                </div>
            </div>

            <!-- WATCHLIST TAB -->
            <div id="tab-1" class="tab-content px-6 pt-6">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-semibold">Watchlist</h2>
                    <div class="text-white/40 text-sm" id="watchlist-count">0 films</div>
                </div>
                <div id="watchlist-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
                <div id="empty-watchlist" class="hidden text-center py-20">
                    <i class="fa-solid fa-film text-6xl text-white/10 mb-6"></i>
                    <p class="text-white/30">Your watchlist is empty.<br>Start adding films.</p>
                </div>
            </div>

            <!-- NEW POST TAB -->
            <div id="tab-2" class="tab-content px-6 pt-6">
                <h2 class="text-3xl font-semibold mb-8">New Log</h2>
                
                <div class="glass border border-white/20 rounded-3xl p-6">
                    <!-- MOVIE SELECT -->
                    <div class="relative mb-6">
                        <input id="movie-search" 
                               onkeyup="filterMovies(this)"
                               type="text" 
                               placeholder="Search film..." 
                               class="w-full bg-transparent border border-white/30 focus:border-white/60 rounded-2xl px-6 py-5 text-lg outline-none">
                        <div id="movie-dropdown" 
                             class="hidden absolute z-50 w-full mt-2 glass border border-white/20 rounded-3xl py-3 max-h-80 overflow-auto"></div>
                    </div>
                    
                    <!-- SELECTED MOVIE -->
                    <div id="selected-movie" class="hidden flex items-center gap-4 bg-black/40 rounded-2xl p-4 mb-6 border border-white/10">
                        <img id="selected-poster" class="w-16 h-24 object-cover rounded-xl" alt="">
                        <div>
                            <div id="selected-title" class="font-semibold"></div>
                            <div id="selected-year" class="text-xs text-white/40"></div>
                        </div>
                        <button onclick="clearSelectedMovie()" 
                                class="ml-auto text-white/40 hover:text-red-400">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                    
                    <!-- RATING -->
                    <div class="mb-8">
                        <div class="text-sm text-white/40 mb-3">YOUR RATING</div>
                        <div id="star-rating" class="flex gap-3 text-5xl">
                            <span onclick="setRating(1)" class="star cursor-pointer text-white/30 hover:text-yellow-400">★</span>
                            <span onclick="setRating(2)" class="star cursor-pointer text-white/30 hover:text-yellow-400">★</span>
                            <span onclick="setRating(3)" class="star cursor-pointer text-white/30 hover:text-yellow-400">★</span>
                            <span onclick="setRating(4)" class="star cursor-pointer text-white/30 hover:text-yellow-400">★</span>
                            <span onclick="setRating(5)" class="star cursor-pointer text-white/30 hover:text-yellow-400">★</span>
                        </div>
                    </div>
                    
                    <!-- REVIEW TEXT -->
                    <textarea id="review-text" 
                              rows="6"
                              placeholder="What did you think?"
                              class="w-full bg-transparent border border-white/20 focus:border-white/50 rounded-3xl p-6 outline-none resize-none text-lg"></textarea>
                    
                    <!-- GIF UPLOAD -->
                    <div class="mt-6">
                        <div id="gif-dropzone"
                             class="border border-dashed border-white/30 hover:border-white/60 rounded-3xl p-8 text-center transition-all cursor-pointer"
                             ondragover="handleDragOver(event)"
                             ondragleave="handleDragLeave(event)"
                             ondrop="handleDrop(event)">
                            <i class="fa-solid fa-cloud-arrow-up text-4xl mb-3 text-white/40"></i>
                            <p class="text-sm text-white/50">Drop GIF or click to upload</p>
                            <input type="file" id="gif-input" accept="image/gif" class="hidden" onchange="handleFileSelect(event)">
                        </div>
                        <div id="gif-preview" class="hidden mt-4 rounded-2xl overflow-hidden border border-white/10">
                            <img id="preview-gif" class="w-full max-h-60 object-contain" alt="GIF preview">
                            <button onclick="removeGif()" 
                                    class="absolute top-3 right-3 bg-black/70 text-white text-xs px-3 py-1 rounded-xl">
                                REMOVE
                            </button>
                        </div>
                    </div>
                    
                    <button onclick="submitReview()" 
                            class="mt-8 w-full bg-white text-black font-semibold py-6 rounded-3xl text-lg tracking-widest hover:bg-white/90 transition-colors flex items-center justify-center gap-3">
                        <span>LOG TO THE VOID</span>
                        <i class="fa-solid fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- PROFILE TAB -->
            <div id="tab-3" class="tab-content px-6 pt-6">
                <!-- BANNER -->
                <div id="profile-banner" 
                     onclick="triggerBannerUpload()"
                     class="h-52 rounded-3xl overflow-hidden relative cursor-pointer border border-white/10 bg-cover bg-center"
                     style="background-image: url('https://picsum.photos/id/1015/1200/400')">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-black/30 to-black/80"></div>
                    <div class="absolute bottom-6 left-6 flex items-center gap-4">
                        <!-- AVATAR -->
                        <div onclick="event.stopImmediatePropagation(); triggerAvatarUpload()" 
                             id="profile-avatar-container"
                             class="w-24 h-24 rounded-3xl border-4 border-black overflow-hidden cursor-pointer shadow-2xl">
                            <img id="profile-avatar" 
                                 src="https://picsum.photos/id/64/300/300" 
                                 class="w-full h-full object-cover">
                        </div>
                        <div>
                            <div class="text-3xl font-semibold" id="profile-name">DIEGO</div>
                            <div class="text-xs text-white/40 font-mono">MEMBER SINCE 2024</div>
                        </div>
                    </div>
                    <div class="absolute top-6 right-6 bg-black/60 text-xs px-4 py-2 rounded-2xl flex items-center gap-2">
                        <i class="fa-solid fa-camera"></i>
                        <span>EDIT BANNER</span>
                    </div>
                </div>
                
                <div class="mt-8 grid grid-cols-3 gap-4 text-center">
                    <div class="glass rounded-3xl p-6">
                        <div class="text-4xl font-semibold" id="stat-films">47</div>
                        <div class="text-xs text-white/40 tracking-widest">FILMS</div>
                    </div>
                    <div class="glass rounded-3xl p-6">
                        <div class="text-4xl font-semibold" id="stat-reviews">19</div>
                        <div class="text-xs text-white/40 tracking-widest">REVIEWS</div>
                    </div>
                    <div class="glass rounded-3xl p-6">
                        <div class="text-4xl font-semibold text-yellow-400" id="stat-avg">4.6</div>
                        <div class="text-xs text-white/40 tracking-widest">AVG</div>
                    </div>
                </div>
                
                <!-- TOP 4 -->
                <div class="mt-12">
                    <div class="flex justify-between items-baseline mb-6">
                        <h3 class="text-2xl font-semibold">Top 4</h3>
                        <span onclick="randomizeTop4()" class="text-xs text-white/40 cursor-pointer hover:text-white">RANDOMIZE</span>
                    </div>
                    <div id="top-four" class="grid grid-cols-2 gap-4"></div>
                </div>
                
                <!-- RECENT ACTIVITY -->
                <div class="mt-16">
                    <h3 class="text-xl font-medium mb-6">Activity</h3>
                    <div id="profile-activity" class="space-y-6"></div>
                </div>
            </div>
        </div>

        <!-- BOTTOM NAV -->
        <div class="bottom-nav fixed bottom-0 left-0 right-0 glass border-t border-white/10 z-50">
            <div class="flex justify-around items-center py-2 max-w-md mx-auto">
                <button onclick="switchTab(0)" 
                        class="tab-btn active flex flex-col items-center py-3 px-5 text-white/60 hover:text-white transition-colors">
                    <i class="fa-solid fa-house text-2xl"></i>
                    <span class="text-[10px] font-mono mt-1">HOME</span>
                </button>
                <button onclick="switchTab(1)" 
                        class="tab-btn flex flex-col items-center py-3 px-5 text-white/60 hover:text-white transition-colors">
                    <i class="fa-solid fa-bookmark text-2xl"></i>
                    <span class="text-[10px] font-mono mt-1">LIST</span>
                </button>
                <button onclick="switchTab(2)" 
                        class="tab-btn flex flex-col items-center py-3 px-5 text-white/60 hover:text-white transition-colors -mt-8">
                    <div class="w-16 h-16 glass border border-white/40 rounded-3xl flex items-center justify-center shadow-2xl">
                        <i class="fa-solid fa-plus text-4xl"></i>
                    </div>
                </button>
                <button onclick="switchTab(3)" 
                        class="tab-btn flex flex-col items-center py-3 px-5 text-white/60 hover:text-white transition-colors">
                    <i class="fa-solid fa-user text-2xl"></i>
                    <span class="text-[10px] font-mono mt-1">ME</span>
                </button>
            </div>
        </div>
    </div>

    <!-- REVIEW MODAL -->
    <div id="review-modal" class="hidden fixed inset-0 z-[100] flex items-end sm:items-center justify-center bg-black/80">
        <div class="modal glass border border-white/20 w-full max-w-xl max-h-[90vh] overflow-hidden rounded-t-3xl sm:rounded-3xl">
            <div class="p-6 border-b border-white/10 flex items-center">
                <button onclick="closeModal()" class="text-3xl text-white/40">←</button>
                <div class="flex-1 text-center font-semibold text-lg">LOG</div>
                <button onclick="closeModal()" class="text-white/40">✕</button>
            </div>
            
            <div class="p-6 overflow-auto" style="max-height: calc(90vh - 70px)">
                <div id="modal-poster" class="w-20 h-28 mx-auto rounded-2xl overflow-hidden mb-6"></div>
                <div id="modal-title" class="text-3xl font-semibold text-center mb-1"></div>
                <div id="modal-rating" class="flex justify-center text-4xl text-yellow-400 mb-8"></div>
                
                <div id="modal-text" class="prose prose-invert max-w-none text-lg leading-relaxed"></div>
                
                <div id="modal-gif-container" class="mt-8"></div>
            </div>
        </div>
    </div>

    <script>
        // Tailwind script already loaded via CDN
        function initTailwind() {
            // Nothing - using CDN classes
        }
        
        // DATA
        let reviews = []
        let watchlist = []
        let profile = {
            name: "DIEGO",
            avatar: "https://picsum.photos/id/64/300/300",
            banner: "https://picsum.photos/id/1015/1200/400",
            top4: [
                {id:1, title:"Dune: Part Two", poster:"https://picsum.photos/id/1015/300/400"},
                {id:2, title:"Challengers", poster:"https://picsum.photos/id/201/300/400"},
                {id:3, title:"Furiosa", poster:"https://picsum.photos/id/133/300/400"},
                {id:4, title:"The Substance", poster:"https://picsum.photos/id/251/300/400"}
            ]
        }
        
        const popularMovies = [
            {id:1, title:"Dune: Part Two", year:2024, poster:"https://picsum.photos/id/1015/300/400"},
            {id:2, title:"Challengers", year:2024, poster:"https://picsum.photos/id/201/300/400"},
            {id:3, title:"Furiosa: A Mad Max Saga", year:2024, poster:"https://picsum.photos/id/133/300/400"},
            {id:4, title:"The Substance", year:2024, poster:"https://picsum.photos/id/251/300/400"},
            {id:5, title:"Civil War", year:2024, poster:"https://picsum.photos/id/180/300/400"},
            {id:6, title:"Kingdom of the Planet of the Apes", year:2024, poster:"https://picsum.photos/id/201/300/400"},
            {id:7, title:"Hit Man", year:2024, poster:"https://picsum.photos/id/133/300/400"},
            {id:8, title:"Longlegs", year:2024, poster:"https://picsum.photos/id/1015/300/400"}
        ]
        
        let selectedMovie = null
        let currentRating = 0
        let currentGifBase64 = null
        let currentTab = 0
        
        // Save to localStorage
        function saveData() {
            localStorage.setItem('illia_reviews', JSON.stringify(reviews))
            localStorage.setItem('illia_watchlist', JSON.stringify(watchlist))
            localStorage.setItem('illia_profile', JSON.stringify(profile))
        }
        
        // Load from localStorage
        function loadData() {
            const savedReviews = localStorage.getItem('illia_reviews')
            if (savedReviews) reviews = JSON.parse(savedReviews)
            
            const savedWatchlist = localStorage.getItem('illia_watchlist')
            if (savedWatchlist) watchlist = JSON.parse(savedWatchlist)
            
            const savedProfile = localStorage.getItem('illia_profile')
            if (savedProfile) profile = JSON.parse(savedProfile)
            
            // Seed data if empty
            if (reviews.length === 0) {
                reviews = [
                    {
                        id: Date.now()-1000,
                        movie: popularMovies[0],
                        rating: 5,
                        text: "Zack Snyder wishes he could shoot sand like this. Villeneuve is the final boss of cinema.",
                        gif: "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExd3J3c3h4c2V4b3Z4c3h4c2V4b3Z4c3h4c2V4b3Z4c3h4c2V4b3Z4/giphy.gif",
                        date: "2d ago"
                    },
                    {
                        id: Date.now()-2000,
                        movie: popularMovies[1],
                        rating: 4,
                        text: "Zendaya serving cunt on the tennis court. This is what cinema is for.",
                        gif: null,
                        date: "5d ago"
                    }
                ]
                saveData()
            }
            
            if (watchlist.length === 0) {
                watchlist = popularMovies.slice(3, 7)
                saveData()
            }
        }
        
        // Render recent reviews
        function renderRecentReviews() {
            const container = document.getElementById('recent-reviews')
            container.innerHTML = ''
            
            reviews.forEach(review => {
                const div = document.createElement('div')
                div.className = 'card glass border border-white/10 rounded-3xl overflow-hidden cursor-pointer'
                div.innerHTML = `
                    <div class="flex gap-5 p-5">
                        <img src="${review.movie.poster}" class="w-20 h-28 object-cover rounded-2xl flex-shrink-0">
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-semibold text-lg leading-tight">${review.movie.title}</div>
                                    <div class="text-xs text-white/40">${review.movie.year}</div>
                                </div>
                                <div class="flex text-2xl text-yellow-400">
                                    ${'★'.repeat(review.rating)}
                                </div>
                            </div>
                            <div class="mt-4 text-white/80 text-[15px] line-clamp-3">${review.text}</div>
                            ${review.gif ? `
                            <img src="${review.gif}" class="review-gif mt-5 w-full">
                            ` : ''}
                            <div class="text-[10px] text-white/30 mt-5 font-mono">${review.date}</div>
                        </div>
                    </div>
                `
                div.onclick = () => showReviewModal(review)
                container.appendChild(div)
            })
        }
        
        // Render recent movies
        function renderRecentMovies() {
            const container = document.getElementById('recent-movies')
            container.innerHTML = ''
            
            popularMovies.forEach(movie => {
                const isInWatchlist = watchlist.some(m => m.id === movie.id)
                
                const div = document.createElement('div')
                div.className = 'card relative rounded-3xl overflow-hidden border border-white/10'
                div.innerHTML = `
                    <img src="${movie.poster}" class="w-full aspect-[2/3] object-cover">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent h-2/3"></div>
                    <div class="absolute bottom-3 left-3 right-3">
                        <div class="text-sm font-medium leading-tight">${movie.title}</div>
                        <div class="text-xs text-white/40">${movie.year}</div>
                    </div>
                    <button onclick="event.stopImmediatePropagation(); toggleWatchlist(${movie.id});" 
                            class="absolute top-3 right-3 w-8 h-8 glass rounded-2xl flex items-center justify-center text-lg ${isInWatchlist ? 'text-emerald-400' : 'text-white/40 hover:text-white'}">
                        ${isInWatchlist ? '✓' : '+'}
                    </button>
                `
                div.onclick = () => {
                    selectedMovie = movie
                    updateSelectedMovieUI()
                    switchTab(2)
                }
                container.appendChild(div)
            })
        }
        
        function toggleWatchlist(id) {
            event.stopImmediatePropagation()
            const movie = popularMovies.find(m => m.id === id)
            const index = watchlist.findIndex(m => m.id === id)
            
            if (index > -1) {
                watchlist.splice(index, 1)
            } else {
                watchlist.push(movie)
            }
            saveData()
            renderRecentMovies()
            renderWatchlist()
        }
        
        // Render watchlist
        function renderWatchlist() {
            const container = document.getElementById('watchlist-grid')
            const empty = document.getElementById('empty-watchlist')
            container.innerHTML = ''
            
            document.getElementById('watchlist-count').textContent = `${watchlist.length} films`
            
            if (watchlist.length === 0) {
                empty.classList.remove('hidden')
                return
            }
            empty.classList.add('hidden')
            
            watchlist.forEach((movie, idx) => {
                const div = document.createElement('div')
                div.className = 'relative rounded-3xl overflow-hidden border border-white/10 card'
                div.innerHTML = `
                    <img src="${movie.poster}" class="w-full aspect-[2/3] object-cover">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent h-1/2"></div>
                    <div class="absolute bottom-3 left-3 text-sm font-medium">${movie.title}</div>
                    <button onclick="removeFromWatchlist(${idx}); event.stopImmediatePropagation()" 
                            class="absolute top-3 right-3 bg-red-500/80 hover:bg-red-600 w-7 h-7 rounded-2xl flex items-center justify-center text-sm">✕</button>
                `
                container.appendChild(div)
            })
        }
        
        function removeFromWatchlist(idx) {
            watchlist.splice(idx, 1)
            saveData()
            renderWatchlist()
            renderRecentMovies()
        }
        
        // Movie search
        function filterMovies(input) {
            const term = input.value.toLowerCase().trim()
            const dropdown = document.getElementById('movie-dropdown')
            
            if (term.length < 1) {
                dropdown.classList.add('hidden')
                return
            }
            
            const filtered = popularMovies.filter(m => 
                m.title.toLowerCase().includes(term)
            )
            
            if (filtered.length === 0) {
                dropdown.classList.add('hidden')
                return
            }
            
            dropdown.innerHTML = ''
            filtered.forEach(movie => {
                const item = document.createElement('div')
                item.className = 'px-6 py-4 hover:bg-white/10 flex gap-4 items-center cursor-pointer'
                item.innerHTML = `
                    <img src="${movie.poster}" class="w-10 h-14 object-cover rounded-xl">
                    <div>
                        <div class="font-medium">${movie.title}</div>
                        <div class="text-xs text-white/40">${movie.year}</div>
                    </div>
                `
                item.onclick = () => {
                    selectedMovie = movie
                    updateSelectedMovieUI()
                    dropdown.classList.add('hidden')
                    input.value = ''
                }
                dropdown.appendChild(item)
            })
            dropdown.classList.remove('hidden')
        }
        
        function updateSelectedMovieUI() {
            const container = document.getElementById('selected-movie')
            if (!selectedMovie) {
                container.classList.add('hidden')
                return
            }
            container.classList.remove('hidden')
            document.getElementById('selected-poster').src = selectedMovie.poster
            document.getElementById('selected-title').textContent = selectedMovie.title
            document.getElementById('selected-year').textContent = selectedMovie.year
        }
        
        function clearSelectedMovie() {
            selectedMovie = null
            updateSelectedMovieUI()
        }
        
        // Star rating
        function setRating(rating) {
            currentRating = rating
            const stars = document.querySelectorAll('#star-rating span')
            stars.forEach((star, i) => {
                star.classList.toggle('text-yellow-400', i < rating)
                star.classList.toggle('text-white/30', i >= rating)
            })
        }
        
        // GIF handling
        function handleDragOver(e) {
            e.preventDefault()
            document.getElementById('gif-dropzone').classList.add('border-white')
        }
        
        function handleDragLeave(e) {
            e.preventDefault()
            document.getElementById('gif-dropzone').classList.remove('border-white')
        }
        
        function handleDrop(e) {
            e.preventDefault()
            document.getElementById('gif-dropzone').classList.remove('border-white')
            const file = e.dataTransfer.files[0]
            if (file && file.type === 'image/gif') processGifFile(file)
        }
        
        function handleFileSelect(e) {
            const file = e.target.files[0]
            if (file && file.type === 'image/gif') processGifFile(file)
        }
        
        function processGifFile(file) {
            const reader = new FileReader()
            reader.onload = function(ev) {
                currentGifBase64 = ev.target.result
                const previewContainer = document.getElementById('gif-preview')
                const previewImg = document.getElementById('preview-gif')
                previewImg.src = currentGifBase64
                previewContainer.classList.remove('hidden')
            }
            reader.readAsDataURL(file)
        }
        
        function removeGif() {
            currentGifBase64 = null
            document.getElementById('gif-preview').classList.add('hidden')
        }
        
        // Submit review
        function submitReview() {
            if (!selectedMovie) {
                alert("PICK A FUCKING MOVIE")
                return
            }
            if (currentRating === 0) {
                alert("GIVE IT STARS YOU COWARD")
                return
            }
            
            const text = document.getElementById('review-text').value.trim()
            
            const newReview = {
                id: Date.now(),
                movie: {...selectedMovie},
                rating: currentRating,
                text: text || "No thoughts. Head empty.",
                gif: currentGifBase64,
                date: "just now"
            }
            
            reviews.unshift(newReview)
            saveData()
            
            // Reset form
            document.getElementById('review-text').value = ''
            currentRating = 0
            setRating(0)
            currentGifBase64 = null
            document.getElementById('gif-preview').classList.add('hidden')
            clearSelectedMovie()
            
            // Go home and refresh
            switchTab(0)
            renderRecentReviews()
        }
        
        // Show review modal
        function showReviewModal(review) {
            const modal = document.getElementById('review-modal')
            document.getElementById('modal-poster').innerHTML = `<img src="${review.movie.poster}" class="w-full h-full object-cover">`
            document.getElementById('modal-title').textContent = review.movie.title
            document.getElementById('modal-rating').innerHTML = '★'.repeat(review.rating)
            
            const textContainer = document.getElementById('modal-text')
            textContainer.innerHTML = marked.parse(review.text)
            
            const gifContainer = document.getElementById('modal-gif-container')
            gifContainer.innerHTML = review.gif ? 
                `<img src="${review.gif}" class="w-full rounded-3xl">` : ''
            
            modal.classList.remove('hidden')
            modal.classList.add('flex')
        }
        
        function closeModal() {
            const modal = document.getElementById('review-modal')
            modal.classList.add('hidden')
            modal.classList.remove('flex')
        }
        
        // Profile renders
        function renderProfile() {
            // Banner & avatar
            document.getElementById('profile-banner').style.backgroundImage = `url('${profile.banner}')`
            document.getElementById('profile-avatar').src = profile.avatar
            document.getElementById('profile-name').textContent = profile.name
            
            // Stats
            document.getElementById('stat-films').textContent = watchlist.length + reviews.length + 12
            document.getElementById('stat-reviews').textContent = reviews.length
            const avg = reviews.length ? 
                (reviews.reduce((a, r) => a + r.rating, 0) / reviews.length).toFixed(1) : '4.2'
            document.getElementById('stat-avg').textContent = avg
            
            // Top 4
            const topContainer = document.getElementById('top-four')
            topContainer.innerHTML = ''
            profile.top4.forEach(movie => {
                const d = document.createElement('div')
                d.className = 'rounded-3xl overflow-hidden border border-white/10'
                d.innerHTML = `<img src="${movie.poster}" class="w-full aspect-video object-cover">`
                topContainer.appendChild(d)
            })
            
            // Activity (last 3 reviews)
            const actContainer = document.getElementById('profile-activity')
            actContainer.innerHTML = ''
            reviews.slice(0, 3).forEach(r => {
                const el = document.createElement('div')
                el.className = 'flex gap-4'
                el.innerHTML = `
                    <img src="${r.movie.poster}" class="w-12 h-16 object-cover rounded-2xl">
                    <div class="flex-1">
                        <div class="font-medium">${r.movie.title}</div>
                        <div class="text-xs text-white/40">${r.date}</div>
                        <div class="text-sm text-white/70 line-clamp-2 mt-1">${r.text}</div>
                    </div>
                `
                actContainer.appendChild(el)
            })
        }
        
        function triggerBannerUpload() {
            const input = document.createElement('input')
            input.type = 'file'
            input.accept = 'image/*'
            input.onchange = e => {
                const file = e.target.files[0]
                if (!file) return
                const reader = new FileReader()
                reader.onload = ev => {
                    profile.banner = ev.target.result
                    saveData()
                    renderProfile()
                }
                reader.readAsDataURL(file)
            }
            input.click()
        }
        
        function triggerAvatarUpload() {
            const input = document.createElement('input')
            input.type = 'file'
            input.accept = 'image/*'
            input.onchange = e => {
                const file = e.target.files[0]
                if (!file) return
                const reader = new FileReader()
                reader.onload = ev => {
                    profile.avatar = ev.target.result
                    saveData()
                    renderProfile()
                }
                reader.readAsDataURL(file)
            }
            input.click()
        }
        
        function randomizeTop4() {
            // Shuffle a bit
            profile.top4 = [...popularMovies].sort(() => Math.random() - 0.5).slice(0,4)
            saveData()
            renderProfile()
        }
        
        // Tab switching
        function switchTab(tab) {
            currentTab = tab
            
            // Hide all
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active')
            })
            
            // Show target
            document.getElementById(`tab-${tab}`).classList.add('active')
            
            // Update nav buttons
            document.querySelectorAll('.tab-btn').forEach((btn, i) => {
                if (i === 0 && tab === 0) btn.classList.add('active')
                else if (i === 1 && tab === 1) btn.classList.add('active')
                else if (i === 3 && tab === 3) btn.classList.add('active')
                else btn.classList.remove('active')
            })
            
            // Refresh content
            if (tab === 0) {
                renderRecentReviews()
                renderRecentMovies()
            } else if (tab === 1) {
                renderWatchlist()
            } else if (tab === 3) {
                renderProfile()
            }
        }
        
        // Enter app
        function enterApp() {
            const landing = document.getElementById('landing')
            landing.style.transform = 'scale(0.92)'
            landing.style.opacity = '0'
            
            setTimeout(() => {
                landing.classList.add('hidden')
                document.getElementById('main-app').classList.remove('hidden')
                document.getElementById('main-app').style.opacity = '1'
                
                // Initial renders
                renderRecentReviews()
                renderRecentMovies()
                renderWatchlist()
                renderProfile()
                switchTab(0)
            }, 900)
        }
        
        function logout() {
            if (confirm("Leave ILLIA?")) {
                document.getElementById('main-app').classList.add('hidden')
                document.getElementById('landing').classList.remove('hidden')
                document.getElementById('landing').style.transform = ''
                document.getElementById('landing').style.opacity = '1'
            }
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.metaKey && e.key === "k") {
                e.preventDefault()
                switchTab(2)
                document.getElementById('movie-search').focus()
            }
        })
        
        // Init everything
        window.onload = function() {
            loadData()
            initTailwind()
            
            // Make dropzone clickable
            document.getElementById('gif-dropzone').addEventListener('click', () => {
                document.getElementById('gif-input').click()
            })
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                const dropdown = document.getElementById('movie-dropdown')
                if (!document.getElementById('movie-search').contains(e.target)) {
                    dropdown.classList.add('hidden')
                }
            })
            
            // Prevent body scroll on modal but already handled
            console.log('%cILLIA v4.20 ready. No rules. No mercy.', 'color:#fff; font-family:monospace')
        }
    </script>
</body>
</html>
