<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ILLIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;family=Playfair+Display:wght@700&amp;display=swap');
        
        .glass {
            background: rgba(0, 0, 0, 0.82);
            backdrop-filter: blur(64px);
            -webkit-backdrop-filter: blur(64px);
            border: 1px solid rgba(255,255,255,0.25);
            box-shadow: inset 0 0 80px rgba(255,255,255,0.06), 0 25px 50px -12px rgb(0 0 0 / 0.5);
        }
        
        .nav-glass {
            background: rgba(0, 0, 0, 0.92);
            backdrop-filter: blur(64px);
        }
        
        .card {
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .card:hover {
            transform: translateY(-12px) scale(1.03);
            box-shadow: 0 30px 60px -12px rgb(0 0 0 / 0.6);
        }
        
        .landing {
            transition: all 1.4s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .heavy-border {
            border: 1.5px solid rgba(255,255,255,0.35);
        }
        
        .star {
            transition: all 0.2s ease;
        }
        
        .modal {
            animation: modalPop 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.85) translateY(60px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .bottom-nav {
            box-shadow: 0 -20px 40px -15px rgba(255,255,255,0.15);
        }
    </style>
</head>
<body class="bg-black text-white overflow-hidden">
    <!-- LANDING -->
    <div id="landing" class="landing fixed inset-0 z-50 flex items-center justify-center bg-black">
        <div class="text-center">
            <h1 class="text-[130px] leading-none font-black tracking-[-0.09em] text-white" style="font-family: 'Playfair Display', serif; text-shadow: 0 0 100px rgba(255,255,255,0.4);">ILLIA</h1>
            <p class="text-white/30 text-sm tracking-[6px] font-mono mt-3">YOUR PRIVATE CINEMA VAULT</p>
            <button onclick="enterApp()" class="glass heavy-border mt-16 px-20 py-7 rounded-3xl text-3xl font-semibold tracking-[3px] hover:scale-105 active:scale-95 transition-all flex items-center gap-6 mx-auto">
                ENTER THE VOID
                <i class="fa-solid fa-arrow-right text-4xl"></i>
            </button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app" class="hidden min-h-screen flex flex-col">
        <!-- HEADER -->
        <div class="nav-glass border-b border-white/20 px-6 py-5 fixed top-0 left-0 right-0 z-40 flex items-center justify-between">
            <div class="text-3xl font-black tracking-tighter">ILLIA</div>
            <i onclick="logout()" class="fa-solid fa-right-from-bracket text-2xl cursor-pointer"></i>
        </div>

        <!-- CONTENT -->
        <div class="flex-1 pt-20 pb-28 overflow-y-auto" id="content-area">
            
            <!-- HOME -->
            <div id="tab-0" class="tab-content active px-6 pt-6">
                <h2 class="text-4xl font-semibold mb-2">Recent Logs</h2>
                <div id="recent-reviews" class="space-y-8"></div>

                <div class="mt-14">
                    <div class="flex justify-between mb-6">
                        <h2 class="text-4xl font-semibold">Recent Films</h2>
                    </div>
                    <div id="recent-movies" class="grid grid-cols-2 sm:grid-cols-3 gap-5"></div>
                </div>
            </div>

            <!-- WATCHLIST -->
            <div id="tab-1" class="tab-content px-6 pt-6">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-4xl font-semibold">Watchlist</h2>
                    <button onclick="showCustomMovieModal()" 
                            class="glass heavy-border px-8 py-4 rounded-3xl text-lg flex items-center gap-3 hover:bg-white/10">
                        <i class="fa-solid fa-plus"></i>
                        <span>ADD CUSTOM FILM</span>
                    </button>
                </div>
                <div id="watchlist-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-5"></div>
                <div id="empty-watchlist" class="hidden text-center py-24">
                    <i class="fa-solid fa-film text-8xl text-white/10"></i>
                    <p class="mt-8 text-white/40">Empty. Add something.</p>
                </div>
            </div>

            <!-- NEW POST -->
            <div id="tab-2" class="tab-content px-6 pt-6">
                <h2 class="text-4xl font-semibold mb-8">New Log</h2>
                
                <div class="glass heavy-border rounded-3xl p-7">
                    <div class="relative mb-8">
                        <input id="movie-search" onkeyup="filterMovies(this)" type="text" placeholder="Search or type film name..." 
                               class="w-full bg-transparent border border-white/30 focus:border-white/70 rounded-3xl px-7 py-6 text-xl outline-none">
                        <div id="movie-dropdown" class="hidden absolute z-50 w-full mt-3 glass heavy-border rounded-3xl py-2 max-h-96 overflow-auto"></div>
                    </div>

                    <button onclick="showCustomMovieModalForReview()" 
                            class="w-full py-5 border border-white/30 hover:border-white/70 rounded-3xl text-sm tracking-widest mb-8">+ ADD CUSTOM FILM INSTEAD</button>

                    <div id="selected-movie" class="hidden flex gap-5 items-center bg-black/40 border border-white/10 rounded-3xl p-5">
                        <img id="selected-poster" class="w-20 h-28 rounded-2xl object-cover">
                        <div class="flex-1">
                            <div id="selected-title" class="font-semibold text-xl"></div>
                            <div id="selected-year" class="text-white/40"></div>
                        </div>
                        <button onclick="clearSelectedMovie()" class="text-3xl text-red-400">✕</button>
                    </div>

                    <div class="my-8">
                        <div class="text-xs tracking-widest text-white/40 mb-4">RATING</div>
                        <div id="star-rating" class="flex gap-4 text-6xl">
                            <span onclick="setRating(1)" class="star cursor-pointer text-white/30">★</span>
                            <span onclick="setRating(2)" class="star cursor-pointer text-white/30">★</span>
                            <span onclick="setRating(3)" class="star cursor-pointer text-white/30">★</span>
                            <span onclick="setRating(4)" class="star cursor-pointer text-white/30">★</span>
                            <span onclick="setRating(5)" class="star cursor-pointer text-white/30">★</span>
                        </div>
                    </div>

                    <textarea id="review-text" rows="5" placeholder="Your thoughts..." 
                              class="w-full glass heavy-border rounded-3xl p-7 text-lg outline-none"></textarea>

                    <div id="gif-dropzone" 
                         class="mt-8 border border-dashed border-white/40 hover:border-white/70 rounded-3xl p-10 text-center cursor-pointer transition-all"
                         ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                        <i class="fa-solid fa-cloud-arrow-up text-5xl mb-4 text-white/40"></i>
                        <p class="text-white/50">Drop GIF here or tap</p>
                        <input type="file" id="gif-input" accept="image/gif" class="hidden" onchange="handleFileSelect(event)">
                    </div>

                    <div id="gif-preview" class="hidden mt-6 relative rounded-3xl overflow-hidden border border-white/10">
                        <img id="preview-gif" class="w-full">
                        <button onclick="removeGif()" class="absolute top-4 right-4 bg-black/80 px-5 py-2 rounded-2xl text-xs">REMOVE GIF</button>
                    </div>

                    <button onclick="submitReview()" 
                            class="mt-10 w-full py-7 bg-white text-black font-black text-xl rounded-3xl tracking-[2px] hover:bg-white/90">LOG IT TO THE VOID</button>
                </div>
            </div>

            <!-- PROFILE -->
            <div id="tab-3" class="tab-content px-6 pt-6">
                <div id="profile-banner" onclick="triggerBannerUpload()" 
                     class="h-60 rounded-3xl bg-cover bg-center relative cursor-pointer heavy-border overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/80"></div>
                    <div class="absolute bottom-6 left-6 flex items-center gap-6">
                        <div onclick="event.stopImmediatePropagation(); triggerAvatarUpload()" 
                             class="w-28 h-28 rounded-3xl border-4 border-black overflow-hidden cursor-pointer">
                            <img id="profile-avatar" src="https://picsum.photos/id/64/300/300" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <div id="profile-name" class="text-4xl font-bold">DIEGO</div>
                            <div class="text-xs font-mono text-white/40">SINCE 2024</div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-4 mt-10">
                    <div class="glass heavy-border rounded-3xl p-6 text-center">
                        <div id="stat-films" class="text-5xl font-bold">69</div>
                        <div class="text-xs tracking-widest text-white/40 mt-1">FILMS</div>
                    </div>
                    <div class="glass heavy-border rounded-3xl p-6 text-center">
                        <div id="stat-reviews" class="text-5xl font-bold">23</div>
                        <div class="text-xs tracking-widest text-white/40 mt-1">LOGS</div>
                    </div>
                    <div class="glass heavy-border rounded-3xl p-6 text-center">
                        <div id="stat-avg" class="text-5xl font-bold text-yellow-400">4.8</div>
                        <div class="text-xs tracking-widest text-white/40 mt-1">AVG</div>
                    </div>
                </div>

                <div class="mt-12">
                    <h3 class="text-2xl font-semibold mb-6">Top 4</h3>
                    <div id="top-four" class="grid grid-cols-2 gap-5"></div>
                </div>
            </div>
        </div>

        <!-- BOTTOM NAV -->
        <div class="bottom-nav nav-glass fixed bottom-0 left-0 right-0 border-t border-white/20 z-50 py-2">
            <div class="flex justify-around max-w-md mx-auto">
                <button onclick="switchTab(0)" class="tab-btn flex flex-col items-center py-2 text-white/60">
                    <i class="fa-solid fa-house text-3xl"></i>
                    <span class="text-[10px] font-mono">HOME</span>
                </button>
                <button onclick="switchTab(1)" class="tab-btn flex flex-col items-center py-2 text-white/60">
                    <i class="fa-solid fa-bookmark text-3xl"></i>
                    <span class="text-[10px] font-mono">LIST</span>
                </button>
                <button onclick="switchTab(2)" class="tab-btn flex flex-col items-center -mt-9">
                    <div class="w-20 h-20 glass heavy-border rounded-3xl flex items-center justify-center text-5xl shadow-2xl">+</div>
                </button>
                <button onclick="switchTab(3)" class="tab-btn flex flex-col items-center py-2 text-white/60">
                    <i class="fa-solid fa-user text-3xl"></i>
                    <span class="text-[10px] font-mono">ME</span>
                </button>
            </div>
        </div>
    </div>

    <!-- CUSTOM MOVIE MODAL -->
    <div id="custom-modal" class="hidden fixed inset-0 z-[200] bg-black/90 flex items-center justify-center">
        <div class="glass heavy-border w-full max-w-lg mx-4 rounded-3xl p-8">
            <div class="flex justify-between items-center mb-8">
                <div class="text-3xl font-semibold">New Film</div>
                <button onclick="hideCustomModal()" class="text-4xl text-white/40">✕</button>
            </div>
            
            <input id="custom-title" placeholder="Title" class="w-full py-6 px-7 rounded-3xl glass heavy-border mb-4 text-xl">
            <input id="custom-year" type="number" placeholder="Year" class="w-full py-6 px-7 rounded-3xl glass heavy-border mb-8 text-xl">
            
            <div id="custom-poster-zone"
                 class="border-2 border-dashed border-white/40 hover:border-white/70 rounded-3xl p-12 text-center cursor-pointer transition-all min-h-52"
                 ondragover="event.preventDefault()" ondrop="handleCustomPosterDrop(event)">
                <i class="fa-solid fa-image text-6xl mb-6 text-white/30"></i>
                <p class="text-white/50">DROP POSTER HERE<br><span class="text-xs">(or click)</span></p>
                <input type="file" id="custom-poster-file" accept="image/*" class="hidden" onchange="handleCustomPosterFile(event)">
            </div>
            
            <div id="custom-poster-preview" class="hidden mt-6 rounded-3xl overflow-hidden border border-white/20">
                <img id="custom-poster-img" class="w-full">
            </div>
            
            <button onclick="saveCustomMovie()" 
                    class="mt-10 w-full py-7 bg-white text-black rounded-3xl text-xl font-black tracking-widest">ADD TO WATCHLIST</button>
        </div>
    </div>

    <!-- REVIEW MODAL -->
    <div id="review-modal" class="hidden fixed inset-0 z-[150] bg-black/90 flex items-end sm:items-center justify-center">
        <div class="modal glass heavy-border w-full max-w-xl rounded-t-3xl sm:rounded-3xl max-h-[92vh] overflow-hidden">
            <div class="p-6 border-b border-white/20 flex items-center">
                <button onclick="closeReviewModal()" class="text-3xl">←</button>
                <div class="flex-1 text-center font-semibold">LOG DETAIL</div>
            </div>
            <div class="p-8 overflow-auto" style="max-height: calc(92vh - 70px)">
                <div id="modal-poster" class="mx-auto w-28 h-40 rounded-3xl overflow-hidden mb-6"></div>
                <div id="modal-title" class="text-center text-3xl font-semibold"></div>
                <div id="modal-rating-stars" class="flex justify-center text-5xl text-yellow-400 my-6"></div>
                <div id="modal-review-text" class="text-lg leading-relaxed"></div>
                <div id="modal-gif" class="mt-10"></div>
            </div>
        </div>
    </div>

    <script>
        let reviews = []
        let watchlist = []
        let customMovies = []
        let profile = { name: "DIEGO", avatar: "https://picsum.photos/id/64/300/300", banner: "https://picsum.photos/id/1015/2000/600" }
        
        const seedMovies = [
            {id: 1, title:"Dune: Part Two", year:2024, poster:"https://picsum.photos/id/1015/300/450"},
            {id: 2, title:"Challengers", year:2024, poster:"https://picsum.photos/id/201/300/450"},
            {id: 3, title:"Furiosa", year:2024, poster:"https://picsum.photos/id/133/300/450"},
            {id: 4, title:"The Substance", year:2024, poster:"https://picsum.photos/id/251/300/450"}
        ]
        
        let allMovies = [...seedMovies]
        let selectedMovie = null
        let currentRating = 0
        let currentGif = null
        let currentCustomPoster = null
        
        function saveData() {
            localStorage.setItem('illia_reviews', JSON.stringify(reviews))
            localStorage.setItem('illia_watchlist', JSON.stringify(watchlist))
            localStorage.setItem('illia_custom_movies', JSON.stringify(customMovies))
            localStorage.setItem('illia_profile', JSON.stringify(profile))
        }
        
        function loadData() {
            if (localStorage.getItem('illia_reviews')) reviews = JSON.parse(localStorage.getItem('illia_reviews'))
            if (localStorage.getItem('illia_watchlist')) watchlist = JSON.parse(localStorage.getItem('illia_watchlist'))
            if (localStorage.getItem('illia_custom_movies')) {
                customMovies = JSON.parse(localStorage.getItem('illia_custom_movies'))
                allMovies = [...seedMovies, ...customMovies]
            }
            if (localStorage.getItem('illia_profile')) profile = JSON.parse(localStorage.getItem('illia_profile'))
            
            if (reviews.length === 0) {
                reviews = [
                    {id: 1730000000000, movie: seedMovies[0], rating: 5, text: "Absolute masterpiece. The sand looked wet.", gif: null, date: "1d ago"},
                    {id: 1730000000001, movie: seedMovies[1], rating: 4, text: "Tennis has never been this horny.", gif: null, date: "3d ago"}
                ]
            }
            if (watchlist.length === 0) watchlist = [seedMovies[2], seedMovies[3]]
            saveData()
        }
        
        function renderRecentReviews() {
            const c = document.getElementById('recent-reviews')
            c.innerHTML = ''
            reviews.forEach(r => {
                const d = document.createElement('div')
                d.className = 'card glass heavy-border rounded-3xl overflow-hidden cursor-pointer'
                d.innerHTML = `
                    <div class="flex p-6 gap-6">
                        <img src="${r.movie.poster}" class="w-24 h-36 object-cover rounded-2xl">
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <div>
                                    <div class="font-semibold text-xl">${r.movie.title}</div>
                                    <div class="text-xs text-white/40">${r.movie.year}</div>
                                </div>
                                <div class="text-4xl text-yellow-400">${'★'.repeat(r.rating)}</div>
                            </div>
                            <p class="mt-5 text-white/80 line-clamp-4">${r.text}</p>
                            \( {r.gif ? `<img src=" \){r.gif}" class="mt-6 w-full rounded-2xl">` : ''}
                            <div class="text-xs text-white/30 mt-6">${r.date}</div>
                        </div>
                    </div>
                `
                d.onclick = () => showReviewModal(r)
                c.appendChild(d)
            })
        }
        
        function renderRecentMovies() {
            const c = document.getElementById('recent-movies')
            c.innerHTML = ''
            allMovies.slice(0, 8).forEach(m => {
                const inList = watchlist.some(w => w.id === m.id)
                const d = document.createElement('div')
                d.className = 'card relative rounded-3xl overflow-hidden heavy-border'
                d.innerHTML = `
                    <img src="${m.poster}" class="w-full aspect-[2/3] object-cover">
                    <div class="absolute inset-x-0 bottom-0 h-2/3 bg-gradient-to-t from-black/90 to-transparent"></div>
                    <div class="absolute bottom-4 left-4 text-sm font-medium">${m.title}</div>
                    <button onclick="event.stopImmediatePropagation(); toggleWatchlistItem(${m.id});" 
                            class="absolute top-4 right-4 w-9 h-9 rounded-2xl glass flex items-center justify-center text-xl ${inList ? 'text-emerald-400' : 'text-white/60'}">
                        ${inList ? '✓' : '+'}
                    </button>
                `
                d.onclick = () => { selectedMovie = m; updateSelectedUI(); switchTab(2) }
                c.appendChild(d)
            })
        }
        
        function toggleWatchlistItem(id) {
            event.stopImmediatePropagation()
            const movie = allMovies.find(m => m.id === id)
            const idx = watchlist.findIndex(m => m.id === id)
            if (idx > -1) watchlist.splice(idx, 1)
            else watchlist.push(movie)
            saveData()
            renderRecentMovies()
            renderWatchlist()
        }
        
        function renderWatchlist() {
            const c = document.getElementById('watchlist-grid')
            const empty = document.getElementById('empty-watchlist')
            c.innerHTML = ''
            
            if (watchlist.length === 0) {
                empty.classList.remove('hidden')
                return
            }
            empty.classList.add('hidden')
            
            watchlist.forEach((m, i) => {
                const d = document.createElement('div')
                d.className = 'card relative rounded-3xl overflow-hidden heavy-border'
                d.innerHTML = `
                    <img src="${m.poster}" class="w-full aspect-[2/3] object-cover">
                    <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/90 h-1/2"></div>
                    <div class="absolute bottom-4 left-4 text-sm">${m.title}</div>
                    <button onclick="event.stopImmediatePropagation(); removeWatchlist(${i});" 
                            class="absolute top-4 right-4 bg-red-500 w-8 h-8 rounded-2xl flex items-center justify-center text-sm">✕</button>
                `
                c.appendChild(d)
            })
        }
        
        function removeWatchlist(i) {
            watchlist.splice(i, 1)
            saveData()
            renderWatchlist()
            renderRecentMovies()
        }
        
        function filterMovies(inp) {
            const val = inp.value.toLowerCase().trim()
            const dd = document.getElementById('movie-dropdown')
            if (val.length < 2) { dd.classList.add('hidden'); return }
            
            const filtered = allMovies.filter(m => m.title.toLowerCase().includes(val))
            dd.innerHTML = ''
            filtered.forEach(m => {
                const el = document.createElement('div')
                el.className = 'px-6 py-5 hover:bg-white/10 flex gap-4 cursor-pointer'
                el.innerHTML = `<img src="\( {m.poster}" class="w-12 h-18 object-cover rounded-xl"><div><div class="font-medium"> \){m.title}</div><div class="text-xs text-white/40">${m.year}</div></div>`
                el.onclick = () => {
                    selectedMovie = m
                    updateSelectedUI()
                    dd.classList.add('hidden')
                    inp.value = ''
                }
                dd.appendChild(el)
            })
            dd.classList.remove('hidden')
        }
        
        function updateSelectedUI() {
            const box = document.getElementById('selected-movie')
            if (!selectedMovie) { box.classList.add('hidden'); return }
            box.classList.remove('hidden')
            document.getElementById('selected-poster').src = selectedMovie.poster
            document.getElementById('selected-title').textContent = selectedMovie.title
            document.getElementById('selected-year').textContent = selectedMovie.year
        }
        
        function clearSelectedMovie() {
            selectedMovie = null
            updateSelectedUI()
        }
        
        function setRating(n) {
            currentRating = n
            const stars = document.querySelectorAll('#star-rating span')
            stars.forEach((s,i) => s.classList.toggle('text-yellow-400', i < n))
        }
        
        function handleDragOver(e) { e.preventDefault(); document.getElementById('gif-dropzone').classList.add('border-white') }
        function handleDragLeave(e) { e.preventDefault(); document.getElementById('gif-dropzone').classList.remove('border-white') }
        function handleDrop(e) {
            e.preventDefault()
            document.getElementById('gif-dropzone').classList.remove('border-white')
            const file = e.dataTransfer.files[0]
            if (file && file.type.includes('gif')) processGif(file)
        }
        function handleFileSelect(e) {
            const file = e.target.files[0]
            if (file && file.type.includes('gif')) processGif(file)
        }
        function processGif(file) {
            const r = new FileReader()
            r.onload = ev => {
                currentGif = ev.target.result
                const prev = document.getElementById('gif-preview')
                document.getElementById('preview-gif').src = currentGif
                prev.classList.remove('hidden')
            }
            r.readAsDataURL(file)
        }
        function removeGif() {
            currentGif = null
            document.getElementById('gif-preview').classList.add('hidden')
        }
        
        function submitReview() {
            if (!selectedMovie) return alert("PICK A MOVIE FIRST")
            if (currentRating === 0) return alert("RATE THE FUCKING THING")
            
            const text = document.getElementById('review-text').value || "No notes."
            
            reviews.unshift({
                id: Date.now(),
                movie: selectedMovie,
                rating: currentRating,
                text: text,
                gif: currentGif,
                date: "just now"
            })
            
            saveData()
            clearForm()
            switchTab(0)
            renderRecentReviews()
        }
        
        function clearForm() {
            document.getElementById('review-text').value = ''
            currentRating = 0
            setRating(0)
            currentGif = null
            document.getElementById('gif-preview').classList.add('hidden')
            clearSelectedMovie()
        }
        
        function showReviewModal(r) {
            const m = document.getElementById('review-modal')
            document.getElementById('modal-poster').innerHTML = `<img src="${r.movie.poster}" class="w-full h-full object-cover">`
            document.getElementById('modal-title').textContent = r.movie.title
            document.getElementById('modal-rating-stars').innerHTML = '★'.repeat(r.rating)
            document.getElementById('modal-review-text').innerHTML = marked.parse(r.text)
            document.getElementById('modal-gif').innerHTML = r.gif ? `<img src="${r.gif}" class="rounded-3xl w-full">` : ''
            m.classList.remove('hidden')
            m.classList.add('flex')
        }
        
        function closeReviewModal() {
            const m = document.getElementById('review-modal')
            m.classList.add('hidden')
            m.classList.remove('flex')
        }
        
        function showCustomMovieModal() {
            currentCustomPoster = null
            document.getElementById('custom-poster-preview').classList.add('hidden')
            document.getElementById('custom-title').value = ''
            document.getElementById('custom-year').value = ''
            document.getElementById('custom-modal').classList.remove('hidden')
            document.getElementById('custom-modal').classList.add('flex')
        }
        
        function showCustomMovieModalForReview() {
            showCustomMovieModal()
            // after save it will be used for review too
        }
        
        function hideCustomModal() {
            document.getElementById('custom-modal').classList.add('hidden')
            document.getElementById('custom-modal').classList.remove('flex')
        }
        
        function handleCustomPosterDrop(e) {
            e.preventDefault()
            const file = e.dataTransfer.files[0]
            if (file && file.type.startsWith('image/')) processCustomPoster(file)
        }
        
        function handleCustomPosterFile(e) {
            const file = e.target.files[0]
            if (file && file.type.startsWith('image/')) processCustomPoster(file)
        }
        
        function processCustomPoster(file) {
            const r = new FileReader()
            r.onload = ev => {
                currentCustomPoster = ev.target.result
                const prev = document.getElementById('custom-poster-preview')
                document.getElementById('custom-poster-img').src = currentCustomPoster
                prev.classList.remove('hidden')
            }
            r.readAsDataURL(file)
        }
        
        function saveCustomMovie() {
            const title = document.getElementById('custom-title').value.trim()
            const year = document.getElementById('custom-year').value.trim()
            
            if (!title || !year || !currentCustomPoster) {
                alert("FILL EVERYTHING YOU LAZY FUCK")
                return
            }
            
            const newMovie = {
                id: Date.now(),
                title: title,
                year: parseInt(year),
                poster: currentCustomPoster
            }
            
            customMovies.push(newMovie)
            allMovies.push(newMovie)
            watchlist.push(newMovie)
            
            saveData()
            hideCustomModal()
            renderWatchlist()
            renderRecentMovies()
            
            // auto select for review if in new post tab
            if (document.getElementById('tab-2').classList.contains('active')) {
                selectedMovie = newMovie
                updateSelectedUI()
            }
        }
        
        function renderProfile() {
            document.getElementById('profile-banner').style.backgroundImage = `url('${profile.banner}')`
            document.getElementById('profile-avatar').src = profile.avatar
            document.getElementById('profile-name').textContent = profile.name
            document.getElementById('stat-films').textContent = watchlist.length + 42
            document.getElementById('stat-reviews').textContent = reviews.length
            const avg = reviews.length ? (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1) : "4.7"
            document.getElementById('stat-avg').textContent = avg
            
            const top = document.getElementById('top-four')
            top.innerHTML = ''
            allMovies.slice(0,4).forEach(m => {
                const d = document.createElement('div')
                d.className = 'rounded-3xl overflow-hidden heavy-border'
                d.innerHTML = `<img src="${m.poster}" class="w-full">`
                top.appendChild(d)
            })
        }
        
        function triggerBannerUpload() {
            const i = document.createElement('input')
            i.type = 'file'
            i.accept = 'image/*'
            i.onchange = e => {
                const f = e.target.files[0]
                const r = new FileReader()
                r.onload = ev => {
                    profile.banner = ev.target.result
                    saveData()
                    renderProfile()
                }
                r.readAsDataURL(f)
            }
            i.click()
        }
        
        function triggerAvatarUpload() {
            const i = document.createElement('input')
            i.type = 'file'
            i.accept = 'image/*'
            i.onchange = e => {
                const f = e.target.files[0]
                const r = new FileReader()
                r.onload = ev => {
                    profile.avatar = ev.target.result
                    saveData()
                    renderProfile()
                }
                r.readAsDataURL(f)
            }
            i.click()
        }
        
        function switchTab(n) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'))
            document.getElementById(`tab-${n}`).classList.add('active')
            
            if (n === 0) { renderRecentReviews(); renderRecentMovies() }
            if (n === 1) renderWatchlist()
            if (n === 3) renderProfile()
        }
        
        function enterApp() {
            document.getElementById('landing').style.opacity = '0'
            setTimeout(() => {
                document.getElementById('landing').classList.add('hidden')
                document.getElementById('main-app').classList.remove('hidden')
                switchTab(0)
            }, 800)
        }
        
        function logout() {
            if (confirm("LOG OUT?")) location.reload()
        }
        
        window.onload = () => {
            loadData()
            renderRecentReviews()
            renderRecentMovies()
            renderWatchlist()
            renderProfile()
            
            document.getElementById('custom-poster-zone').onclick = () => document.getElementById('custom-poster-file').click()
            console.log('%cILLIA FIXED. GLASS THICK. NO MORE WHINING.', 'color:#fff;font-size:13px;font-family:monospace')
        }
    </script>
</body>
</html>
